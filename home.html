<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ChaynupZine｜レコード詳細</title>
<meta http-equiv="Cache-Control" content="no-store" />
<style>
body{background:#f6f6f6;color:#111;font-family:system-ui,-apple-system,"Noto Sans JP","Hiragino Sans",sans-serif}
main{max-width:880px;margin:auto;padding:20px}
a{color:#2E66CC;text-decoration:none}
img.cover{max-width:100%;height:auto;border-radius:8px;background:#ddd}
h1{margin:16px 0 8px;font-size:28px;font-weight:900}
.meta{font-size:14px;color:#555;margin:8px 0}
.desc{font-size:14px;line-height:1.7;margin-top:8px}
.poster{font-size:12px;color:#555;margin-top:8px}
iframe{width:100%;aspect-ratio:16/9;border:none;margin-top:20px}
</style>
</head>
<body>
<main>
  <a href="index.html">← 一覧へ戻る</a>
  <div id="content"></div>
</main>

<script>
const API = "https://script.google.com/macros/s/AKfycbzYGnZZ2N5qsSPGdVi-X4YGRLkDapGpj9zqdUAo5rNxnEsFewxCC1DpYNjJD1Xkhn8eZA/exec";

function onImgError(ev){
  ev.target.onerror=null;
  ev.target.src="https://placehold.co/800x800?text=No+Image";
}

async function main(){
  const params = new URLSearchParams(location.search);
  const id = parseInt(params.get("id"), 10);
  const container = document.getElementById("content");
  if(isNaN(id)){ container.innerHTML = "<p>不正なアクセスです。</p>"; return; }

  try{
    const res = await fetch(API + "?t=" + Date.now(), {cache:"no-store"});
    const j = await res.json();
    const rows = j.items || [];
    if(!rows[id]){ container.innerHTML = "<p>データが見つかりません。</p>"; return; }

    const row = rows[id];
    let youtube = "";
    if(row.youtubeId){
      youtube = `<iframe src="https://www.youtube.com/embed/${row.youtubeId}" allowfullscreen></iframe>`;
    }

    container.innerHTML = `
      <img class="cover" src="${row.imageUrl || 'https://placehold.co/800x800?text=No+Image'}" alt="cover" onerror="onImgError(event)">
      <h1>${row.band || ""} – ${row.track || ""}</h1>
      <p class="meta">${row.genre || ""} | ${row.country || ""} | ${row.timestamp || ""}</p>
      <div class="desc">${row.desc || ""}</div>
      <div class="poster">投稿者: ${row.poster || ""}</div>
      ${youtube}
    `;
  }catch(err){
    container.innerHTML = `<p>読み込みに失敗しました: ${String(err)}</p>`;
  }
}
main();
</script>
</body>
</html>
